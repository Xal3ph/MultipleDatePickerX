angular.module("multipleDatePickerX",[]).factory("multipleDatePickerXBroadcast",["$rootScope",function(a){var b={};return b.calendarId=null,b.message="",b.resetOrder=function(a){this.message="reset",this.calendarId=a,this.broadcastItem()},b.broadcastItem=function(){a.$broadcast("handlemultipleDatePickerXBroadcast")},b}]).directive("multipleDatePickerX",["$log","multipleDatePickerXBroadcast",function(a,b){"use strict";return{restrict:"AE",scope:{calendarId:"=?",count:"=?",countRowMax:"=?",mode:"=?",callback:"&",dateClick:"=?",dateHover:"=?",calendar:"=?",calendarChanged:"=?",datesSelected:"=?",datesOff:"=?",highlightDates:"=?",allDatesOff:"=?",cssDaysOfSurroundingMonths:"=?",disallowBackPastYears:"=",disallowGoFuturYears:"=",hideButtons:"=?",selectionMode:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",leftArrowContent:"=?",rightArrowContent:"=?"},templateUrl:"template/multiple-date-picker-template.html",link:function(b,c,d){var e=function(){var a=moment(),c=moment(b.calendar).subtract(1,b.mode),d=moment(b.calendar).add(1,b.mode);b.disableBackButton=b.disallowBackPastYears&&a.isAfter(c,b.mode),b.disableNextButton=b.disallowGoFuturYears&&a.isBefore(d,b.mode)},f=function(){for(var a=moment().localeData()._weekdaysMin,c=[],d=1;7>d;d++)c.push(a[d]);return b.sundayFirstDay?c.splice(0,0,a[0]):c.push(a[0]),c};b.$watch("datesSelected",function(a){if(a){var c=[];a.map(function(a){c.push(moment(a))}),b.convertedDaysSelected=c,b.generate()}},!0),b.$watch("datesOff",function(c){void 0!==c&&a.warn("datesOff option deprecated since version 1.1.6, please use highlightDates"),b.generate()},!0),b.$watch("highlightDates",function(){b.generate()},!0),b.$watch("allDatesOff",function(){b.generate()},!0),b.$watch("mode",function(){b.init()},!0),b.$watch("calendar",function(){b.generate()},!0),b.init=function(){switch(b.mode=b.mode||"month",b.mode){case"year":b.topRowDateFormat="YYYY",b.dateFormat="MMM",b.modeDate="month";break;case"month":b.topRowDateFormat="MMMM YYYY",b.dateFormat="D",b.modeDate="day";break;default:b.topRowDateFormat="MMMM YYYY",b.dateFormat="D",b.modeDate="day"}b.calendar=b.calendar||moment().startOf(b.mode),b.days=[],b.convertedDaysSelected=b.convertedDaysSelected||[],b.datesOff=b.datesOff||[],b.disableBackButton=!1,b.disableNextButton=!1,b.rightArrowContent=">",b.leftArrowContent="<",b.daysOfWeek=f(),b.cssDaysOfSurroundingYears=b.cssDaysOfSurroundingYears||"picker-empty",b.hideButtons=b.hideButtons||!1,b.selectionMode=b.selectionMode||"unit",b.Math=Math,b.count=b.count||1,b.countRowMax=b.countRowMax||2,b.calendars=[];for(var a=0;a<b.count;++a)b.calendars[a]=moment().startOf(b.mode).add(a,b.mode);b.generate()},b.toggleDay=function(c,d){c.preventDefault();var e=!1;c.preventDefault=function(){e=!0},"function"==typeof b.dateClick&&b.dateClick(c,d),d.selectable&&!e&&(d.selected=!d.selected,d.selected?b.convertedDaysSelected.push(d):b.convertedDaysSelected=b.convertedDaysSelected.filter(function(a){return a.valueOf()!==d.valueOf()}),"function"==typeof b.callback&&(a.warn("callback option deprecated, please use dateClick"),b.callback({timestamp:d.valueOf(),selected:d.selected})))},b.hoverDay=function(a,c){a.preventDefault();var d=!1;a.preventDefault=function(){d=!0},"function"==typeof b.dateHover&&b.dateHover(a,c),d||(c.hover="mouseover"===a.type?!0:!1)},b.previous=function(){if(!b.disableBackButton){var a=moment(b.calendar);b.calendar.subtract(1,b.mode);for(var c=0;c<b.count;++c)b.calendars[c]=moment(b.calendar.clone().add(c,b.mode));"function"==typeof b.calendarChanged&&b.calendarChanged(b.calendar,a),b.generate()}},b.next=function(){if(!b.disableNextButton){var a=moment(b.calendar);b.calendar.add(1,b.mode);for(var c=0;c<b.count;++c)b.calendars[c]=moment(b.calendar.clone().add(c,b.mode));"function"==typeof b.calendarChanged&&b.calendarChanged(b.calendar,a),b.generate()}},b.isDayOff=function(a,b){return a.allDatesOff||!!a.disableDaysBefore&&moment(b).isBefore(a.disableDaysBefore,"day")||!!a.disableDaysAfter&&moment(b).isAfter(a.disableDaysAfter,"day")||angular.isArray(a.datesOff)&&a.datesOff.some(function(c){return b.isSame(c,a.modeDate)})||angular.isArray(a.highlightDates)&&a.highlightDates.some(function(c){return b.isSame(c.date,a.modeDate)&&!c.selectable})},b.isSelected=function(a,b){return a.convertedDaysSelected.some(function(c){return b.isSame(c,a.modeDate)})},b.generate=function(){for(var a=moment(),c=function(a){return a.date&&l.isSame(a.date,b.modeDate)||!a.to&&a.from&&(l.isAfter(a.from,b.modeDate)||l.isSame(a.from,b.modeDate))||!a.from&&a.to&&l.isBefore(a.to,b.modeDate)||l.isSame(a.to,b.modeDate)||a.from&&(l.isAfter(a.from,b.modeDate)||l.isSame(a.from,b.modeDate))&&a.to&&(l.isBefore(a.to,b.modeDate)||l.isSame(a.from,b.modeDate))},d=0;d<b.calendars.length;++d){var f=moment().locale(b.displayLocale||"").localeData()._monthsShort,g=[],h=[];if("year"==b.mode)h=f;else for(var i=new Date(b.calendars[d].get("year"),b.calendars[d].get("month")+1,0).getDate(),j=0;i>j;++j)h[j]=moment(b.calendars[d].get("year")+"-"+(b.calendars[d].get("month")+1)+"-"+(j+1),"YYYY-MM-D");for(var k=0;k<h.length;++k){var l=h[k];if("year"==b.mode&&(l=moment("1 "+h[k]+" "+b.calendars[d].year())),angular.isArray(b.highlightDates)){var m;if(m=b.highlightDates.filter(c)[0])for(var n in m)"date"!=n&&(l[n]=m[n])}l.selectable=!b.isDayOff(b,l),l.selected=b.isSelected(b,l),l.today=l.isSame(a,"day"),g.push(l)}b.months||(b.months=[]),b.months[d]=g}e()},b.init()}}}]);