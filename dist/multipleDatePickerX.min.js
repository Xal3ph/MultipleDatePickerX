angular.module("multipleDatePickerX",[]).factory("multipleDatePickerXBroadcast",["$rootScope",function(a){var b={};return b.calendarId=null,b.message="",b.resetOrder=function(a){this.message="reset",this.calendarId=a,this.broadcastItem()},b.broadcastItem=function(){a.$broadcast("handleMultipleDateXPickerBroadcast")},b}]).directive("multipleDatePickerX",["$log","multipleDatePickerXBroadcast",function(a,b){"use strict";return{restrict:"AE",scope:{calendarId:"=?",count:"=?",countRowMax:"=?",mode:"=?",callback:"&",dateClick:"=?",dateHover:"=?",calendar:"=?",calendarChanged:"=?",datesSelected:"=?",datesOff:"=?",highlightDates:"=?",allDatesOff:"=?",cssDaysOfSurroundingMonths:"=?",disallowBackPastYears:"=",disallowGoFuturYears:"=",hideButtons:"=?",selectionMode:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",leftArrowContent:"=?",rightArrowContent:"=?"},templateUrl:"template/multiple-date-picker-template.html",link:function(c,d,e){var f=function(){var a=moment(),b=moment(c.calendar).subtract(1,c.mode),d=moment(c.calendar).add(1,c.mode);c.disableBackButton=c.disallowBackPastYears&&a.isAfter(b,c.mode),c.disableNextButton=c.disallowGoFuturYears&&a.isBefore(d,c.mode)},g=function(){for(var a=moment().localeData()._weekdaysMin,b=[],d=1;7>d;d++)b.push(a[d]);return c.sundayFirstDay?b.splice(0,0,a[0]):b.push(a[0]),b},h=function(){var a=c.daysSelected||[],b=[];a.map(function(a){b.push(moment(a))}),c.convertedDaysSelected=b,c.generate()};c.$on("handleMultipleDateXPickerBroadcast",function(){"reset"!==b.message||b.calendarId&&b.calendarId!==c.calendarId||h()}),c.$watch("datesSelected",function(a){if(a){var b=[];a.map(function(a){b.push(moment(a))}),c.convertedDaysSelected=b,c.generate()}},!0),c.$watch("datesOff",function(b){void 0!==b&&a.warn("datesOff option deprecated since version 1.1.6, please use highlightDates"),c.generate()},!0),c.$watch("highlightDates",function(){c.generate()},!0),c.$watch("allDatesOff",function(){c.generate()},!0),c.$watch("mode",function(){c.init()},!0),c.$watch("calendar",function(){c.generate()},!0),c.init=function(){switch(c.mode=c.mode||"month",c.mode){case"year":c.topRowDateFormat="YYYY",c.dateFormat="MMM",c.modeDate="month";break;case"month":c.topRowDateFormat="MMMM YYYY",c.dateFormat="D",c.modeDate="day";break;default:c.topRowDateFormat="MMMM YYYY",c.dateFormat="D",c.modeDate="day"}c.calendar=c.calendar||moment().startOf(c.mode),c.days=[],c.convertedDaysSelected=c.convertedDaysSelected||[],c.datesOff=c.datesOff||[],c.disableBackButton=!1,c.disableNextButton=!1,c.rightArrowContent=c.rightArrowContent||">",c.leftArrowContent=c.leftArrowContent||"<",c.daysOfWeek=g(),c.cssDaysOfSurroundingYears=c.cssDaysOfSurroundingYears||"picker-empty",c.hideButtons=c.hideButtons||!1,c.selectionMode=c.selectionMode||"unit",c.Math=Math,c.count=c.count||1,c.countRowMax=c.countRowMax||2,c.calendars=[];for(var a=0;a<c.count;++a)c.calendars[a]=moment().startOf(c.mode).add(a,c.mode);c.generate()},c.toggleDay=function(b,d){b.preventDefault();var e=!1;b.preventDefault=function(){e=!0},"function"==typeof c.dateClick&&c.dateClick(b,d),d.selectable&&!e&&(d.selected=!d.selected,d.selected?c.convertedDaysSelected.push(d):c.convertedDaysSelected=c.convertedDaysSelected.filter(function(a){return a.valueOf()!==d.valueOf()}),"function"==typeof c.callback&&(a.warn("callback option deprecated, please use dateClick"),c.callback({timestamp:d.valueOf(),selected:d.selected})))},c.hoverDay=function(a,b){a.preventDefault();var d=!1;a.preventDefault=function(){d=!0},"function"==typeof c.dateHover&&c.dateHover(a,b),d||(b.hover="mouseover"===a.type?!0:!1)},c.previous=function(){if(!c.disableBackButton){var a=moment(c.calendar);c.calendar.subtract(1,c.mode);for(var b=0;b<c.count;++b)c.calendars[b]=moment(c.calendar.clone().add(b,c.mode));"function"==typeof c.calendarChanged&&c.calendarChanged(c.calendar,a),c.generate()}},c.next=function(){if(!c.disableNextButton){var a=moment(c.calendar);c.calendar.add(1,c.mode);for(var b=0;b<c.count;++b)c.calendars[b]=moment(c.calendar.clone().add(b,c.mode));"function"==typeof c.calendarChanged&&c.calendarChanged(c.calendar,a),c.generate()}},c.isDayOff=function(a,b){return a.allDatesOff||!!a.disableDaysBefore&&moment(b).isBefore(a.disableDaysBefore,"day")||!!a.disableDaysAfter&&moment(b).isAfter(a.disableDaysAfter,"day")||angular.isArray(a.datesOff)&&a.datesOff.some(function(c){return b.isSame(c,a.modeDate)})||angular.isArray(a.highlightDates)&&a.highlightDates.some(function(c){return b.isSame(c.date,a.modeDate)&&!c.selectable})},c.isSelected=function(a,b){return a.convertedDaysSelected.some(function(c){return b.isSame(c,a.modeDate)})},c.isSameMonth=function(a,b){return a.convertedDaysSelected.some(function(c){return b.isSame(c,a.modeDate)})},c.generate=function(){for(var a=moment(),b=function(a){return a.date&&l.isSame(a.date,c.modeDate)||!a.to&&a.from&&(l.isAfter(a.from,c.modeDate)||l.isSame(a.from,c.modeDate))||!a.from&&a.to&&l.isBefore(a.to,c.modeDate)||l.isSame(a.to,c.modeDate)||a.from&&(l.isAfter(a.from,c.modeDate)||l.isSame(a.from,c.modeDate))&&a.to&&(l.isBefore(a.to,c.modeDate)||l.isSame(a.from,c.modeDate))},d=0;d<c.calendars.length;++d){var e=moment().locale(c.displayLocale||"").localeData()._monthsShort,g=[],h=[];if("year"==c.mode)h=e;else for(var i=new Date(c.calendars[d].get("year"),c.calendars[d].get("month")+1,0).getDate(),j=0;i>j;++j)h[j]=moment(c.calendars[d].get("year")+"-"+(c.calendars[d].get("month")+1)+"-"+(j+1),"YYYY-MM-D");for(var k=0;k<h.length;++k){var l=h[k];if("year"==c.mode)l=moment("1 "+h[k]+" "+c.calendars[d].year());else if(0===k)for(var m=7-moment(l).weekday(),n=7;n-m>0;--n)g.push(moment(l).subtract(n-m,"days"));if(angular.isArray(c.highlightDates)){var o;if(o=c.highlightDates.filter(b)[0])for(var p in o)"date"!=p&&(l[p]=o[p])}"year"==c.mode?l.sameMonth=!0:l.sameMonth=c.calendars[d].get("month")==l.get("month"),l.selectable=!c.isDayOff(c,l),l.selected=c.isSelected(c,l),l.today=l.isSame(a,"day"),g.push(l)}c.months||(c.months=[]),c.months[d]=g}f()},c.init()}}}]);